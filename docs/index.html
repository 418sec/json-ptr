<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>json-ptr</title>
	<meta name="description" content="Documentation for json-ptr">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">json-ptr</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>json-ptr</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#json-ptr" id="json-ptr" style="color: inherit; text-decoration: none;">
					<h1>json-ptr</h1>
				</a>
				<p><a href="https://circleci.com/gh/flitbit/json-ptr/tree/master"><img src="https://circleci.com/gh/flitbit/json-ptr/tree/master.svg?style=svg" alt="CircleCI"></a></p>
				<p>A complete implementation of JSON Pointer (<a href="https://tools.ietf.org/html/rfc6901">RFC 6901</a>) for nodejs and modern browsers.</p>
				<a href="#background" id="background" style="color: inherit; text-decoration: none;">
					<h2>Background</h2>
				</a>
				<p>I wrote this a few years back when I was unable to find a <em>complete implementation</em> of <a href="https://tools.ietf.org/html/rfc6901">RFC 6901</a>. It turns out that I now use the hell out of it.</p>
				<a href="#install" id="install" style="color: inherit; text-decoration: none;">
					<h2>Install</h2>
				</a>
				<pre><code class="language-bash">npm install json-ptr</code></pre>
				<a href="#use" id="use" style="color: inherit; text-decoration: none;">
					<h2>Use</h2>
				</a>
				<a href="#nodejs" id="nodejs" style="color: inherit; text-decoration: none;">
					<h3><a href="https://nodejs.org/en/">nodejs</a></h3>
				</a>
				<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { JsonPointer, create } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;json-ptr&#x27;</span>;</code></pre>
				<a href="#example" id="example" style="color: inherit; text-decoration: none;">
					<h3>Example</h3>
				</a>
				<p>There are many uses for JSON Pointers, here&#39;s one we encountered when we updated a public API and suddenly had clients sending two different message bodies to our APIs. This example is contrived to illustrate how we supported both new and old incoming messages:</p>
				<pre><code class="language-ts"><span class="hljs-comment">// examples/versions.ts</span>
<span class="hljs-keyword">import</span> { JsonPointer } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;json-ptr&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> SupportedVersion = <span class="hljs-string">&#x27;1.0&#x27;</span> | <span class="hljs-string">&#x27;1.1&#x27;</span>;

<span class="hljs-keyword">interface</span> PrimaryGuestNamePointers {
  name: JsonPointer;
  surname: JsonPointer;
  honorific: JsonPointer;
}
<span class="hljs-keyword">const</span> versions: Record&lt;SupportedVersion, PrimaryGuestNamePointers&gt; = {
  <span class="hljs-string">&#x27;1.0&#x27;</span>: {
    name: JsonPointer.create(<span class="hljs-string">&#x27;/guests/0/name&#x27;</span>),
    surname: JsonPointer.create(<span class="hljs-string">&#x27;/guests/0/surname&#x27;</span>),
    honorific: JsonPointer.create(<span class="hljs-string">&#x27;/guests/0/honorific&#x27;</span>),
  },
  <span class="hljs-string">&#x27;1.1&#x27;</span>: {
    name: JsonPointer.create(<span class="hljs-string">&#x27;/primary/primaryGuest/name&#x27;</span>),
    surname: JsonPointer.create(<span class="hljs-string">&#x27;/primary/primaryGuest/surname&#x27;</span>),
    honorific: JsonPointer.create(<span class="hljs-string">&#x27;/primary/primaryGuest/honorific&#x27;</span>),
  }
};

<span class="hljs-keyword">interface</span> Reservation <span class="hljs-keyword">extends</span> Record&lt;string, unknown&gt; {
  version?: SupportedVersion;
}

<span class="hljs-comment">/**
 * Gets the primary guest&#x27;s name from the specified reservation.
 * @param reservation a reservation, either version 1.0 or bearing a `version`
 * property indicating the version.
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">primaryGuestName</span>(<span class="hljs-params">reservation: Reservation</span>): <span class="hljs-title">string</span> </span>{
  <span class="hljs-keyword">const</span> pointers = versions[reservation.version || <span class="hljs-string">&#x27;1.0&#x27;</span>];
  <span class="hljs-keyword">if</span> (!pointers) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Unsupported reservation version: <span class="hljs-subst">${reservation.version}</span>`</span>);
  }
  <span class="hljs-keyword">const</span> name = pointers.name.get(reservation) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">const</span> surname = pointers.surname.get(reservation) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">const</span> honorific = pointers.honorific.get(reservation) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">const</span> names: <span class="hljs-built_in">string</span>[] = [];
  <span class="hljs-keyword">if</span> (honorific) names.push(honorific);
  <span class="hljs-keyword">if</span> (name) names.push(name);
  <span class="hljs-keyword">if</span> (surname) names.push(surname);
  <span class="hljs-keyword">return</span> names.join(<span class="hljs-string">&#x27; &#x27;</span>);
}

<span class="hljs-comment">// The original layout of a reservation (only the parts relevant to our example)</span>
<span class="hljs-keyword">const</span> reservationV1: Reservation = {
  guests: [{
    name: <span class="hljs-string">&#x27;Wilbur&#x27;</span>,
    surname: <span class="hljs-string">&#x27;Finkle&#x27;</span>,
    honorific: <span class="hljs-string">&#x27;Mr.&#x27;</span>
  }, {
    name: <span class="hljs-string">&#x27;Wanda&#x27;</span>,
    surname: <span class="hljs-string">&#x27;Finkle&#x27;</span>,
    honorific: <span class="hljs-string">&#x27;Mrs.&#x27;</span>
  }, {
    name: <span class="hljs-string">&#x27;Wilma&#x27;</span>,
    surname: <span class="hljs-string">&#x27;Finkle&#x27;</span>,
    honorific: <span class="hljs-string">&#x27;Miss&#x27;</span>,
    child: <span class="hljs-literal">true</span>,
    age: <span class="hljs-number">12</span>
  }]
  <span class="hljs-comment">// ...</span>
};

<span class="hljs-comment">// The new layout of a reservation (only the parts relevant to our example)</span>
<span class="hljs-keyword">const</span> reservationV1_1: Reservation = {
  version: <span class="hljs-string">&#x27;1.1&#x27;</span>,
  primary: {
    primaryGuest: {
      name: <span class="hljs-string">&#x27;Wilbur&#x27;</span>,
      surname: <span class="hljs-string">&#x27;Finkle&#x27;</span>,
      honorific: <span class="hljs-string">&#x27;Mr.&#x27;</span>
    },
    additionalGuests: [{
      name: <span class="hljs-string">&#x27;Wanda&#x27;</span>,
      surname: <span class="hljs-string">&#x27;Finkle&#x27;</span>,
      honorific: <span class="hljs-string">&#x27;Mrs.&#x27;</span>
    }, {
      name: <span class="hljs-string">&#x27;Wilma&#x27;</span>,
      surname: <span class="hljs-string">&#x27;Finkle&#x27;</span>,
      honorific: <span class="hljs-string">&#x27;Miss&#x27;</span>,
      child: <span class="hljs-literal">true</span>,
      age: <span class="hljs-number">12</span>
    }]
    <span class="hljs-comment">// ...</span>
  }
  <span class="hljs-comment">// ...</span>
};

<span class="hljs-built_in">console</span>.log(primaryGuestName(reservationV1));
<span class="hljs-built_in">console</span>.log(primaryGuestName(reservationV1_1));
</code></pre>
				<a href="#api-documentation" id="api-documentation" style="color: inherit; text-decoration: none;">
					<h2>API Documentation</h2>
				</a>
				<p>The API documentation is generated from code comments by typedoc and <a href="">hosted here</a>.</p>
				<p>We welcome new issues if you have questions or need additional documentation.</p>
				<a href="#performance" id="performance" style="color: inherit; text-decoration: none;">
					<h2>Performance</h2>
				</a>
				<p>This repository has a <a href="https://github.com/flitbit/json-pointer-comparison">companion repository that makes some performance comparisons</a> between <code>json-ptr</code>, <a href="https://www.npmjs.com/package/jsonpointer"><code>jsonpointer</code></a> and <a href="https://www.npmjs.com/package/json-pointer"><code>json-pointer</code></a>.</p>
				<p><strong>All timings are expressed as nanoseconds:</strong></p>
				<pre><code class="language-text">.flatten(obj)
...
MODULE       | METHOD  | COMPILED | SAMPLES |       AVG | SLOWER
json-pointer | dict    |          | 10      | 464455181 |
json-ptr     | flatten |          | 10      | 770424039 | 65.88%
jsonpointer  | n/a     |          | -       |         - |

.has(obj, pointer)
...
MODULE       | METHOD | COMPILED | SAMPLES | AVG  | SLOWER
json-ptr     | has    | compiled | 1000000 | 822  |
json-ptr     | has    |          | 1000000 | 1747 | 112.53%
json-pointer | has    |          | 1000000 | 2683 | 226.4%
jsonpointer  | n/a    |          | -       | -    |

.has(obj, fragmentId)
...
MODULE       | METHOD | COMPILED | SAMPLES | AVG  | SLOWER
json-ptr     | has    | compiled | 1000000 | 602  |
json-ptr     | has    |          | 1000000 | 1664 | 176.41%
json-pointer | has    |          | 1000000 | 2569 | 326.74%
jsonpointer  | n/a    |          | -       | -    |

.get(obj, pointer)
...
MODULE       | METHOD | COMPILED | SAMPLES | AVG  | SLOWER
json-ptr     | get    | compiled | 1000000 | 590  |
json-ptr     | get    |          | 1000000 | 1676 | 184.07%
jsonpointer  | get    | compiled | 1000000 | 2102 | 256.27%
jsonpointer  | get    |          | 1000000 | 2377 | 302.88%
json-pointer | get    |          | 1000000 | 2585 | 338.14%

.get(obj, fragmentId)
...
MODULE       | METHOD | COMPILED | SAMPLES | AVG  | SLOWER
json-ptr     | get    | compiled | 1000000 | 587  |
json-ptr     | get    |          | 1000000 | 1673 | 185.01%
jsonpointer  | get    | compiled | 1000000 | 2105 | 258.6%
jsonpointer  | get    |          | 1000000 | 2451 | 317.55%
json-pointer | get    |          | 1000000 | 2619 | 346.17%
</code></pre>
				<blockquote>
					<p>These results have been elided because there is too much detail in the actual. Your results will vary slightly depending on the resources available where you run it.</p>
				</blockquote>
				<p>It is important to recognize in the performance results that <em>compiled</em> options are faster. As a general rule, you should <em>compile</em> any pointers you&#39;ll be using repeatedly.</p>
				<p><em>Consider this example code that queries the flickr API and prints results to the console:</em></p>
				<pre><code class="language-javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span>;

<span class="hljs-keyword">let</span> ptr = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;..&#x27;</span>),
  http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>),
  util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);

<span class="hljs-comment">// A flickr feed, tags surf,pipeline</span>
<span class="hljs-keyword">let</span> feed = <span class="hljs-string">&#x27;http://api.flickr.com/services/feeds/photos_public.gne?tags=surf,pipeline&amp;tagmode=all&amp;format=json&amp;jsoncallback=processResponse&#x27;</span>;

<span class="hljs-comment">// Compile/prepare the pointers...</span>
<span class="hljs-keyword">let</span> items = ptr.create(<span class="hljs-string">&#x27;#/items&#x27;</span>);
<span class="hljs-keyword">let</span> author = ptr.create(<span class="hljs-string">&#x27;#/author&#x27;</span>);
<span class="hljs-keyword">let</span> media = ptr.create(<span class="hljs-string">&#x27;#/media/m&#x27;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processResponse</span>(<span class="hljs-params">json</span>) </span>{
  <span class="hljs-keyword">let</span> data = items.get(json);

  <span class="hljs-keyword">if</span> (data &amp;&amp; <span class="hljs-built_in">Array</span>.isArray(data)) {
    <span class="hljs-keyword">let</span> images = data.reduce(<span class="hljs-function">(<span class="hljs-params">acc, it</span>) =&gt;</span> {
      <span class="hljs-comment">// Using the prepared pointers to select parts...</span>
      acc.push({
        <span class="hljs-attr">author</span>: author.get(it),
        <span class="hljs-attr">media</span>: media.get(it)
      });
      <span class="hljs-keyword">return</span> acc;
    }, []);
    <span class="hljs-built_in">console</span>.log(util.inspect(images, <span class="hljs-literal">false</span>, <span class="hljs-number">9</span>));
  }
}

http.get(feed, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
  <span class="hljs-keyword">let</span> data = <span class="hljs-string">&#x27;&#x27;</span>;

  res.on(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunk</span>) </span>{
    data += chunk;
  });

  res.on(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// result is formatted as jsonp... this is for illustration only.</span>
    data = <span class="hljs-built_in">eval</span>(data); <span class="hljs-comment">// eslint-disable-line no-eval</span>
    processResponse(data);
  });
}).on(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Got error: &#x27;</span> + e.message);
});</code></pre>
				<blockquote>
					<p>[<a href="https://github.com/flitbit/json-ptr/blob/master/examples/real-world.js">example/real-world.js</a>]</p>
				</blockquote>
				<a href="#tests" id="tests" style="color: inherit; text-decoration: none;">
					<h2>Tests</h2>
				</a>
				<p>Tests are written using <a href="https://mochajs.org/">mocha</a> and <a href="https://github.com/Automattic/expect.js">expect.js</a>.</p>
				<pre><code class="language-bash">npm <span class="hljs-built_in">test</span></code></pre>
				<p>... or ...</p>
				<pre><code class="language-bash">mocha</code></pre>
				<a href="#releases" id="releases" style="color: inherit; text-decoration: none;">
					<h2>Releases</h2>
				</a>
				<ul>
					<li><p>2019-09-14 — <strong>1.2.0</strong></p>
						<ul>
							<li>Merged new <code>.concat</code> function contributed by @vuwuv, updated dependencies.</li>
						</ul>
					</li>
					<li><p>2019-03-10 — <strong>1.1.2</strong></p>
						<ul>
							<li>Updated packages to remove critical security concern among dev dependencies&#39;</li>
						</ul>
					</li>
					<li><p>2016-07-26 — <strong>1.0.1</strong></p>
						<ul>
							<li>Fixed a problem with the Babel configuration</li>
						</ul>
					</li>
					<li><p>2016-01-12 — <strong>1.0.0</strong></p>
						<ul>
							<li>Rolled major version to 1 to reflect breaking change in <code>.list(obj, fragmentId)</code>.</li>
						</ul>
					</li>
					<li><p>2016-01-02 — <strong>0.3.0</strong></p>
						<ul>
							<li>Retooled for node 4+</li>
							<li>Better compiled pointers</li>
							<li>Unrolled recursive <code>.list</code> function</li>
							<li>Added <code>.map</code> function</li>
							<li>Fully linted</li>
							<li>Lots more tests and examples.</li>
							<li>Documented many previously undocumented features.</li>
						</ul>
					</li>
					<li><p>2014-10-21 — <strong>0.2.0</strong>  Added #list function to enumerate all properties in a graph, producing fragmentId/value pairs.</p>
					</li>
				</ul>
				<a href="#license" id="license" style="color: inherit; text-decoration: none;">
					<h2>License</h2>
				</a>
				<p><a href="https://github.com/flitbit/json-ptr/blob/master/LICENSE">MIT</a></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_pointer_.html">&quot;src/pointer&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_types_.html">&quot;src/types&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_src_util_.html">&quot;src/util&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>